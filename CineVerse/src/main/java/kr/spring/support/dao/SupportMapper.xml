<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="kr.spring.support.dao.SupportMapper">

	<insert id="insertConsult" parameterType="consultVO">
		INSERT INTO consult (consult_num,consult_title,consult_content,consult_ip,mem_num,consult_type,consult_file,order_num) 
				VALUES (consult_seq.nextval,#{consult_title},#{consult_content},#{consult_ip},#{mem_num},#{consult_type},#{consult_file, jdbcType=CLOB},#{order_num, jdbcType=BIGINT})
	</insert>
	
	
	<sql id="consultSearch">
		<where><!--조건-->
			<if test="mem_num != null and mem_num != ''">
				mem_num=#{mem_num}
			</if>
		</where>
	</sql>
	<!-- 게시판 글 총레코드수/검색 레코드수 -->
	<select id="selectConsultRowCount" parameterType="map" resultType="integer">
		SELECT COUNT(*) FROM consult JOIN member USING (mem_num) LEFT OUTER JOIN member_detail USING(mem_num)
		<include refid="consultSearch"></include>
	</select>

	<!-- 게시판 전체 목록/검색 목록 -->
	<select id="selectConsultList" parameterType="map" resultType="consultVO">
		SELECT * FROM
				(SELECT a.*, rownum rnum FROM			<!--좋아요가 없을 때 누락-->
								(SELECT 
									consult_num,
									<![CDATA[
									REPLACE(REPLACE(consult_title,'<','&lt;'),'>','&gt;') consult_title,
									]]>
									consult_reg_date,
									consult_status,
									mem_num,
									<![CDATA[
			                        CONCAT(SUBSTR(mem_id, 1, 3), LPAD('*', LENGTH(mem_id) - 3, '*')) AS mem_id
			                        ]]>
									FROM consult 
									JOIN member USING(mem_num) LEFT OUTER JOIN member_detail USING(mem_num)
									<include refid="consultSearch"></include>
									ORDER BY consult_reg_date DESC
									)a) 
		<![CDATA[
		WHERE rnum >= #{start} AND rnum <= #{end}
		]]>
	</select>
	
	
</mapper>							






