<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.spring.admin.dao.AdminMapper"><!--인터페이스명-자동매핑 -->
	<sql id="memberSearch">
		<where>
			<if test="keyfield != null and keyword != null">
				AND
				${keyfield} LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyfield != null and keyfield != ''">
       	        AND 
           	   ${keyfield} LIKE '%' || #{keyword} || '%'
        	</if>
		</where>
	</sql>
	

	<!-- 게시판 전체/검색 목록 -->
	<select id="selectMemberList" parameterType="map"
		resultType="AdminVO">
		SELECT *
		FROM (
		SELECT a.*, rownum rnum
		FROM (
		SELECT
		m.mem_num,
		m.mem_auth,
		m.mem_rank,
		m.mem_id,
		md.mem_name,
		md.mem_phone,
		md.mem_email,
		md.mem_reg_date
		FROM member m
		JOIN member_detail md ON m.mem_num =
		md.mem_num
		<include refid="memberSearch"></include>
		) a
		)
    <![CDATA[
    WHERE rnum >= #{start} AND rnum <= #{end}
    ]]>
	</select>

	
	<!-- 게시판 글 총레코드수/검색 레코드수 -->
	<select id="selectMemberRowCount" parameterType="map"
		resultType="integer">
		SELECT
		COUNT(*)
		FROM member_detail
		<include refid="memberSearch"></include>
	</select>

	
	<!-- 구독 전체/검색 목록 -->
	<sql id="membershipSearch">
		<where>
			<if test="keyfield != null and keyword != null">
				AND
				${keyfield} LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyfield != null and keyfield != ''">
       	        AND 
           	   ${keyfield} LIKE '%' || #{keyword} || '%'
        	</if>
		</where>
	</sql>
	

	<select id="selectMembershipList" parameterType="map"
		resultType="AdminVO">
		SELECT *
		FROM (
		SELECT a.*, rownum rnum
		FROM (
		SELECT
		m.mem_num,
		m.mem_id,
		m.mem_rank,
		m.mem_membership,
		md.mem_name,
		md.mem_reg_date
		FROM member m
		JOIN member_detail md ON m.mem_num =
		md.mem_num
		<include refid="membershipSearch"></include>
		) a
		)
    <![CDATA[
    WHERE rnum >= #{start} AND rnum <= #{end}
    ]]>
	</select>

	
	<!-- 게시판 글 총레코드수/검색 레코드수 -->
	<select id="selectMembershipROwCount" parameterType="map"
		resultType="integer">
		SELECT
		COUNT(*)
		FROM member_detail
		<include refid="membershipSearch"></include>
	</select>
	
	<!-- 이벤트시작 -->
	<!-- 이벤트 목록/검색 -->
		<sql id="eventSearch">
		<where>
			<if test="keyfield != null and keyword != null">
				AND
				${keyfield} LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyfield != null and keyfield != ''">
       	        AND 
           	   ${keyfield} LIKE '%' || #{keyword} || '%'
        	</if>
		</where>
	</sql>
	

	<select id="selectEventList" parameterType="map"
		resultType="EventVO">
		SELECT *
		FROM (
		SELECT a.*, rownum rnum
		FROM (
		SELECT
		event_num,
		event_name,
		event_start,
		event_end,
		event_reg_date
		FROM event
		<include refid="eventSearch"></include>
		) a
		)
    <![CDATA[
    WHERE rnum >= #{start} AND rnum <= #{end}
    ]]>
	</select>

	
	<!-- 게시판 글 총레코드수/검색 레코드수 -->
	<select id="selectEventRowCount" parameterType="map"
		resultType="integer">
		SELECT
		COUNT(*)
		FROM event
		<include refid="eventSearch"></include>
	</select>
	
	<!-- 이벤트 등록 -->
	<insert id="insertEvent" parameterType="EventVO">
		INSERT INTO event(
		event_num,
		event_name,
		event_content,
		event_filename,
		event_start,
		event_end
		)
		VALUES (
		event_seq.nextval,
		#{event_name},
		#{event_content},
		#{event_filename,jdbcType=VARCHAR},
		#{event_start},
		#{event_end})
	</insert>
	
	<!-- 공지사항 시작 -->
	<!-- 공지사항 목록/검색 -->
		<sql id="noticeSearch">
		<where>
			<if test="keyfield != null and keyword != null">
				AND
				${keyfield} LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyfield != null and keyfield != ''">
       	        AND 
           	   ${keyfield} LIKE '%' || #{keyword} || '%'
        	</if>
		</where>
	</sql>
	

	<select id="selectNoticeList" parameterType="map"
		resultType="NoticeVO">
		SELECT *
		FROM (
		SELECT a.*, rownum rnum
		FROM (
		SELECT
		nb_num,
		nb_title,
		nb_hit,
		nb_reg_date
		FROM notice_board
		<include refid="noticeSearch"></include>
		) a
		)
    <![CDATA[
    WHERE rnum >= #{start} AND rnum <= #{end}
    ]]>
	</select>

	
	<!-- 게시판 글 총레코드수/검색 레코드수 -->
	<select id="selectNoticeRowCount" parameterType="map"
		resultType="integer">
		SELECT
		COUNT(*)
		FROM notice_board
		<include refid="noticeSearch"></include>
	</select>
	
	<!-- 공지사항 등록 -->
	<insert id="insertNotice" parameterType="NoticeVO">
		INSERT INTO notice_board
		(
		nb_num,
		nb_title,
		nb_content,
		nb_filename,
		mem_num
		)
		VALUES (
		notice_board_seq.nextval,
		#{nb_title},
		#{nb_content},
		#{nb_filename,jdbcType=VARCHAR},
		#{mem_num}
		)
	</insert>

	<sql id="movieSearch">
		<where>
			<if test="keyfield != null and keyword != null">
				AND m_delete = 1
         	    AND ${keyfield} LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyfield != null and keyword == null">
           		AND m_delete = 1
        </if>
		</where>
	</sql>

	<!-- 게시판 글 총레코드수/검색 레코드수 -->
	<select id="selectMovieRowCount" parameterType="map"
		resultType="integer">
		SELECT
		COUNT(*)
		FROM movie
		<include refid="movieSearch"></include>
	</select>

	<!-- 게시판 전체/검색 목록 -->
	<select id="selectMovie" parameterType="map"
		resultType="MovieVO">
		SELECT
		*
		FROM (
		SELECT
		a.*,
		rownum rnum
		FROM (
		SELECT
		m_code,
                <![CDATA[
                REPLACE(REPLACE(m_name, '<', '&lt;'), '>', '&gt;') AS m_name,
                ]]>
		m_opendate,
		m_companys,
		m_status,
		m_filename
		FROM movie
		<include refid="movieSearch"></include>
		) a
		)
    <![CDATA[
    WHERE rnum >= #{start} AND rnum <= #{end}
    ]]>
	</select>

	<!-- 포인트 시작 -->
	<sql id="pointSearch">
		<where>
			<if test="keyfield != null and keyword != null">
				AND ph_type = 2
         	    AND ${keyfield} LIKE '%' || #{keyword} || '%'
			</if>
			<if test="keyfield != null and keyword == null">
           		AND ph_type = 2
        </if>
		</where>
	</sql>

	<!-- 게시판 글 총레코드수/검색 레코드수 -->
	<select id="selectPointRowCount" parameterType="map"
		resultType="integer">
		SELECT
		COUNT(*)
		FROM point_history
		<include refid="pointSearch"></include>
	</select>

	<!-- 게시판 전체/검색 목록 -->
	<select id="selectPoint" parameterType="map"
		resultType="PointVO">
		SELECT
		*
		FROM (
		SELECT
		a.*,
		rownum rnum
		FROM (
		SELECT
		ph_num,
		ph_point,
		ph_date,
                <![CDATA[
                REPLACE(REPLACE(mem_num, '<', '&lt;'), '>', '&gt;') AS mem_num,
                ]]>
		ph_payment
		FROM point_history
		<include refid="pointSearch"></include>
		) a
		)
    <![CDATA[
    WHERE rnum >= #{start} AND rnum <= #{end}
    ]]>
	</select>
	
	<!-- 영화관 등록 -->
	<insert id="insertCinema" parameterType="cinemaVO">
		INSERT INTO cinema(
		c_num,
		c_branch,
		c_location,
		c_address,
		c_phone,
		c_parkable
		)
		VALUES (
		#{c_num},
		#{c_branch},
		#{c_location},
		#{c_address},
		#{c_phone},
		#{c_parkable})
	</insert>
	
	<!-- 상영관 등록 -->
	<insert id="insertTheater" parameterType="cinemaVO">
		INSERT INTO theater(
		th_num,
		c_num,
		th_name,
		th_position
		)
		VALUES (
		theater_seq.nextval,
		#{c_num},
		#{th_name},
		#{th_position})
	</insert>

	
	<select id="selectTheater" parameterType="String" resultType="TheaterVO">
  		  SELECT th_name
  		  FROM theater
 		  WHERE c_num = #{c_num}
	</select>


</mapper>							






